load("//gendiffer:gendiffer.bzl", "bob_generation_test")
load("@rules_multirun//:defs.bzl", "multirun")

[bob_generation_test(
    name = file[0:-len("/WORKSPACE")],
    bob_binary = "//cmd/bob:bob",
    test_data = glob(
        include = [file[0:-len("/WORKSPACE")] + "/**"],
    ),
) for file in glob(["**/WORKSPACE"])]

multirun(
    name = "verify_snapshots",
    commands = [
        (file[0:-len("/WORKSPACE")] + platform)
        for platform in [
            "_android",
            "_linux",
        ]
        for file in glob(["**/WORKSPACE"])
    ],
)
